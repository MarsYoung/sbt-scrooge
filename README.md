# sbt-scrooge

Sbt-scrooge is an sbt plugin that adds support for using scrooge to
generate thrift.


## Building

Until standard-project is released as an sbt 0.11 plugin, you'll need
to publish local. So... 

    $sbt publish-local


## Testing

There is a really crude scripted plugin. You can run it with

    $sbt scripted
    
## How it works

The plugin registers itself as a source generator for the compile phase.


## Getting SbtScrooge

See https://github.com/harrah/xsbt/wiki/Plugins for information on
adding plugins. In general, you'll need to add the following to your
project/plugins.sbt file:

    addSbtPlugin("com.twitter" % "sbt-scrooge" % "11.0.0-SNAPSHOT")

## Mixing in SbtSCrooge

### Using a .sbt file

    import com.twitter.sbt._

    seq(SbtScrooge.newSettings: _*)
    
    
### Using a .scala build definition

    import sbt._
    import Keys._
    import com.twitter.sbt._
    
    object Util extends Build {
        lazy val root = Project(id = "util", base = file("."))
            settings (SbtScrooge.settings: _*)
    }
    
## Upgrading from sbt-thrift

The scala bindings are not 100% compatible with the scala bindings that were
generated by sbt-thrift. Here are the notable differences:

- You need to add "scrooge-runtime" as a dependency:

    `val scrooge_runtime = "com.twitter" % "scrooge-runtime" % "1.0.3"`

- The names of the interfaces have changed:

  - `(service).ServiceIface` is now `(service).FutureIface`

  - `(service).Service` is now `(service).FinagledService`

  - `(service).Client` is now `(service).FinagledClient`

  - `BinaryThriftSerializer` is now `BinaryThriftStructSerializer[A]`, like:

      `val serializer = new BinaryThriftStructSerializer[Beer] { def codec = Beer }`


## Upgrading from java

If you're switching from java generated code, there are a few other (fairly
large) differences:

- All container types are scala-native (Seq, Set, Map).

- Enums are case objects (but still subclass TEnum).

- Class, struct, and enum names are all converted to StudyCaps, so for
  example `ERROR` becomes `Error`.

- Method names are all converted to camelCase, so for example `GetName`
  becomes `getName` and `set_name` becomes `setName`.

- Structs are case classes, so they are immutable and have real, actual
  constructors (!). Multi-line field-setting struct construction should be
  converted to a single-line case class constuctor call.

- Optional fields are implemented as `Option[A]`.
